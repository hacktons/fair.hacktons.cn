<!--
  ~ Copyright (C) 2005-present, 58.com.  All rights reserved.
  ~ Use of this source code is governed by a BSD type license that can be
  ~ found in the LICENSE file.
  -->

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flutter Fair: A new package used to update widget tree dynamically | Flutter Fair</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="A Flutter package used to update widget tree dynamically">
    
    <link rel="preload" href="/assets/css/0.styles.a833e332.css" as="style"><link rel="preload" href="/assets/js/app.7150d990.js" as="script"><link rel="preload" href="/assets/js/2.a909edba.js" as="script"><link rel="preload" href="/assets/js/23.6c99de55.js" as="script"><link rel="prefetch" href="/assets/js/10.836c1718.js"><link rel="prefetch" href="/assets/js/11.c752bceb.js"><link rel="prefetch" href="/assets/js/12.b3b34a59.js"><link rel="prefetch" href="/assets/js/13.8273986f.js"><link rel="prefetch" href="/assets/js/14.cb363924.js"><link rel="prefetch" href="/assets/js/15.1c1a5f9d.js"><link rel="prefetch" href="/assets/js/16.8fa55493.js"><link rel="prefetch" href="/assets/js/17.830aaa3c.js"><link rel="prefetch" href="/assets/js/18.9ceb572e.js"><link rel="prefetch" href="/assets/js/19.7a60c8ac.js"><link rel="prefetch" href="/assets/js/20.599b087b.js"><link rel="prefetch" href="/assets/js/21.9fdd3e15.js"><link rel="prefetch" href="/assets/js/22.8d5355a6.js"><link rel="prefetch" href="/assets/js/24.4302ae4a.js"><link rel="prefetch" href="/assets/js/25.67c70447.js"><link rel="prefetch" href="/assets/js/26.cafa7432.js"><link rel="prefetch" href="/assets/js/27.1677f5e1.js"><link rel="prefetch" href="/assets/js/28.b295f678.js"><link rel="prefetch" href="/assets/js/29.da887c9d.js"><link rel="prefetch" href="/assets/js/3.e719670d.js"><link rel="prefetch" href="/assets/js/30.cb732564.js"><link rel="prefetch" href="/assets/js/31.0a6e24a1.js"><link rel="prefetch" href="/assets/js/32.f883af3b.js"><link rel="prefetch" href="/assets/js/4.9a31cbb2.js"><link rel="prefetch" href="/assets/js/5.57e5c489.js"><link rel="prefetch" href="/assets/js/6.a6275fda.js"><link rel="prefetch" href="/assets/js/7.d06faa33.js"><link rel="prefetch" href="/assets/js/8.f1740b8f.js"><link rel="prefetch" href="/assets/js/9.20fc1ed2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a833e332.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Flutter Fair</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Sample Menu" class="dropdown-title"><span class="title">Sample</span> <span class="arrow down"></span></button> <button type="button" aria-label="Sample Menu" class="mobile-dropdown-title"><span class="title">Sample</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/hello_fair/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hello Fair
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/fair_design.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/article/fair_design.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/wuba/fair" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Sample Menu" class="dropdown-title"><span class="title">Sample</span> <span class="arrow down"></span></button> <button type="button" aria-label="Sample Menu" class="mobile-dropdown-title"><span class="title">Sample</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/hello_fair/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Hello Fair
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/fair_design.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/article/fair_design.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/wuba/fair" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" class="sidebar-link">Introduction</a></li><li><a href="/guide/usage.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/simple-demo.html" class="sidebar-link">从零开始写一个Demo</a></li><li><a href="/guide/counting-demo.html" class="sidebar-link">Counting计数器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advance</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/layout_definition.html" class="sidebar-link">模板格式</a></li><li><a href="/guide/generate_binding.html" class="sidebar-link">编写组件映射表</a></li><li><a href="/guide/generate_bundle.html" class="sidebar-link">Bundle资源</a></li><li><a href="/guide/layout_sugar.html" class="sidebar-link">模板语法【实验】</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Resource</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/fair_design.html" aria-current="page" class="active sidebar-link">Flutter Fair: A new package used to update widget tree dynamically</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/fair_design.html#why-create-flutter-fair" class="sidebar-link">Why create Flutter Fair?</a></li><li class="sidebar-sub-header"><a href="/article/fair_design.html#prototype-exploration" class="sidebar-link">Prototype exploration</a></li><li class="sidebar-sub-header"><a href="/article/fair_design.html#fair-flutter-over-the-air" class="sidebar-link">Fair — Flutter over the air</a></li><li class="sidebar-sub-header"><a href="/article/fair_design.html#fair-architecture" class="sidebar-link">Fair architecture</a></li><li class="sidebar-sub-header"><a href="/article/fair_design.html#dsl-ast" class="sidebar-link">DSL &amp; AST</a></li><li class="sidebar-sub-header"><a href="/article/fair_design.html#next" class="sidebar-link">Next</a></li></ul></li><li><a href="/article/widget_update.html" class="sidebar-link">组件绑定与局部刷新</a></li><li><a href="/article/build_runner.html" class="sidebar-link">bundle编译实现</a></li><li><a href="/article/performance.html" class="sidebar-link">运行性能情况</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="flutter-fair-a-new-package-used-to-update-widget-tree-dynamically"><a href="#flutter-fair-a-new-package-used-to-update-widget-tree-dynamically" class="header-anchor">#</a> Flutter Fair: A new package used to update widget tree dynamically</h1> <p><img src="https://cdn-images-1.medium.com/max/1600/1*uzMOc9unz1cAuMh0ZwWCVQ.png" alt="fair logo"></p> <blockquote><p>Original published on medium.com <a href="https://medium.com/p/98f6f94cb2bf" target="_blank" rel="noopener noreferrer">Flutter Fair: A new package used to update widget tree dynamically<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="why-create-flutter-fair"><a href="#why-create-flutter-fair" class="header-anchor">#</a> Why create Flutter Fair?</h2> <p>Dynamic feature is almost mentioned in every cross-platform framework. From traditional Web/H5 to React Native, many mobile products depend on dynamic ability to dispatch new features or bug fix. And some team use RN rather than Native, just because RN pages can be updated through remote bundle files.</p> <p>However this case is not possible for Flutter as it can violate the <a href="https://developer.apple.com/app-store/review/guidelines/#software-requirements" target="_blank" rel="noopener noreferrer">AppStore’s review guidelines<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. And the Flutter team has removed code push from its roadmap for 2019: <a href="https://github.com/flutter/flutter/issues/14330#issuecomment-485565194" target="_blank" rel="noopener noreferrer">Code Push / Hot Update / out of band updates #14330<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Flutter Fair is aimed to update widget tree without code push. This bring us the ability to dispatch new UI widgets/pages. We take control of how to generate widget tree with bundle files. After widgets are constructed, they will be rendered by Flutter engine. These dynamic widgets/pages can also work with predefined BLOC component inside Flutter App.</p> <h2 id="prototype-exploration"><a href="#prototype-exploration" class="header-anchor">#</a> Prototype exploration</h2> <p>In order to design the Fair package, we did some prototype exploration to make sure we can handle this. Including community research to find valuable resources.</p> <p>If you have already read the Flutter documents, you may known that Flutter pipeline has several stages. There are three trees related to UI:</p> <ul><li>Widget tree</li> <li>Element tree</li> <li>RenderObject tree</li></ul> <p>All we need to do is generate the widget tree in a proper way, then leave it to Flutter itself.</p> <p>To make a dynamic widget, we use json structure to describe the widget configuration. In Flutter, we declare UI with nested widgets layer, this make json reasonable and quite simple.</p> <p>Here is a ListView constructed by json description.</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*K66AmAmhBJEprgj6.png" alt="img"></p> <p>JSON description:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;className&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ListView.builder&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;na&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;itemBuilder&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#(bizColorLabelBuilder)&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;itemCount&quot;</span><span class="token punctuation">:</span> <span class="token number">50</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Dart source code:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code>ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
  itemBuilder<span class="token punctuation">:</span> bizColorLabelBuilder<span class="token punctuation">,</span>
  itemCount<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>In this demo, we’ve finally figure out three things:</p> <ol><li>JSON based definition of DSL bundle</li> <li>Variable reference in Widget parameters</li> <li>Widget convertor used to construct a Widget from JSON</li></ol> <h2 id="fair-flutter-over-the-air"><a href="#fair-flutter-over-the-air" class="header-anchor">#</a> Fair — Flutter over the air</h2> <p>Our demo is still far away from stable package. So we need to think more about what feature is required if we wish to make a useable flutter package.</p> <blockquote><p>I/O definition</p></blockquote> <p>Our main purpose is to deliver widgets description as bundle file, so it can be update through local assets or URI resource.</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*AdLD-ste2U49vvJm.png" alt="IO direction"></p> <p>From the developer’s point of view, we hope that the developer will be aware of the development changes as little as possible. The use of Fair should be transparent in details as much as possible. This requires that we provide a middleware (compiler) to implement this “transparent action”.</p> <p>In the perspective of Flutter, we need to correctly identify the products of the convention format. This requires that we provide a DartVM capable parser (runtime) that does “run” the artifacts.</p> <p>From the App perspective, we need to manage artifacts, such as loading, persistence, version control, etc. This requires us to provide a set of back-end product management system and mobile loading system.</p> <p>According to the I/O relationship from different perspectives, we can plan several modules coarse-grained：</p> <ul><li>The Fair Plugin: responsible for loading, parsing, and finally displaying the bundle in the form of flutter.</li> <li>Fair Binding Tool: assists with build tools that provide automated transformation capabilities.</li> <li>Fair Manager Server: simple Resource management service.</li> <li>Fair Manager API: Android/iOS side and services used with it</li></ul> <p><img src="https://cdn-images-1.medium.com/max/1600/0*GodzIJ7k7t4M3ZFl.png" alt="img"></p> <blockquote><p>Hands on Fair SDK</p></blockquote> <p>Before moving on to the technical details of Fair, let’s take a look at how to use the SDK. The recommended access posture is as follows: wrap the App in a FairApp component, and you can have fun with all the other widgets:</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*TjPFF6GBgKWjWDkn.png" alt="img"></p> <p>In FairApp, each dynamic page is a FairWidget that can provide a “bundle” with input:</p> <div class="language-dart line-numbers-mode"><pre class="language-dart"><code><span class="token function">FairWidget</span><span class="token punctuation">(</span>
  path<span class="token punctuation">:</span> <span class="token string">'assets/bundle/lib_page_dynamic_widget.fair.bin'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'Red Box'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Where did this bin come from? The bin resource is a product that Fair can identify, which can be understood as a bundle. It can be written by hand or generated automatically through Fair. To turn a ready-made Flutter page into a bundle, you need to add an annotation:</p> <ol><li>Add the @FairPatch annotation to the target page</li> <li>Add the @FairWell annotation to the data object</li></ol> <p><img src="https://cdn-images-1.medium.com/max/1600/0*fECj-wrEciq1qY7F.png" alt="img">
Red box sample</p> <p>Currently, not all Flutter widgets can be converted painlessly with one click. Fair supports transformation of layout classes by default, which requires no logical operations in the build. If there is logic, you need to manually encapsulate or provide the proxy binding object.</p> <h2 id="fair-architecture"><a href="#fair-architecture" class="header-anchor">#</a> Fair architecture</h2> <p>Flutter Fair is evolved from prototype, many external APIs has changed many times in the early stage of development, until they gradually converged and stabilized in the later stage. In the coding process, we need to consider the final effect. The package cannot be arbitrary as in the prototype, we have been convergent parameters to improve readability.</p> <p>The Fair package can be rendered in a plain structure diagram, with the front and back servers removed, there are three pieces:</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*g93Od4zIwx_e0XnH.png" alt="img"></p> <p>In the “runtime” section, it includes the bundle resource loader, the parser, and the component agent layer. The “compiler” section is not like a language compiler. Fair Compiler is a compilation tool based on the build runner mechanism of the Flutter. It is mainly used to generate binding and bundle for dart code.</p> <blockquote><p>Version compatibility</p></blockquote> <p>Everyone who developed Flutter knows that the Flutter version iterates very fast, so it’s worth thinking about how to do a good job of version compatibility.</p> <p>Some tech teams may have been developed early and used an “older version” such as 1.17.x. As of this writing (2020.11.03), the stable version of flutter is 1.22.x now. Although Fair’s API rarely uses a version-specific API, but in order to implement dynamic components, we had to generate a component map in advance, which is a product of full coupling with the flutter version.</p> <p>The flutter was 1.20.x when we developed it, so we generated the flutter component of this version by default. To accommodate the multiple versions, we extract the version sensitive logic into a fair_version library.So once flutter releases a new stable version, we can quickly generate a new corresponding fair_version.</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Switch to another stable flutter version</span>
<span class="token key atrule">dependency_overrides</span><span class="token punctuation">:</span>
  <span class="token key atrule">fair_version</span><span class="token punctuation">:</span>
    <span class="token key atrule">git</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/wuba/fair.git
      <span class="token key atrule">ref</span><span class="token punctuation">:</span> main
      <span class="token key atrule">path</span><span class="token punctuation">:</span> fair_version/flutter_1_12_13
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>Widget mapping</p></blockquote> <p>By writing the component mapping table, Fair can support more widgets, either from the Flutter framework or from three-party components.</p> <p>For example we customized a CustomTag component that needed to generate the binding mapping component and we also wanted to generate additional mapping components for the package component of the convex_bottom_bar community. You can do this:</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*1tHTy3bWGIHdylZt.png" alt="img"></p> <p>The generated code snippet is as follows:</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*LLSsXzqKPCPWBZ5R.png" alt="img"></p> <blockquote><p>Bundle generation</p></blockquote> <p>In order to achieve seamless integration, our goal is to support the generation of business bundles directly from the Flutter layout. Using the build_runner mechanism, we can nicely combine the bundle build with project Flutter. So ideally, all the developer has to do is add the annotations, and then the flutter compiler will generate the artifacts for you.</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*T5Y5qCyDfKy1YZtm.png" alt="img"></p> <h2 id="dsl-ast"><a href="#dsl-ast" class="header-anchor">#</a> DSL &amp; AST</h2> <p>I guess those of you reading so far are really interested in Flutter. These two nouns are very common, and both are general concepts that have nothing to do with language:</p> <ul><li>DSL : Domain Specific Language</li> <li>AST: Abstract Syntax Tree</li></ul> <p>In Flutter Fair, DSL is the expression of our intermediates, and AST is the expression of our primary products for analysis.</p> <p>In Fair Complier, we have designed a layer of Fairc, which is an important part of an auxiliary compilation tool that provides DSL generation capabilities based on the AST to help developers quickly generate DSL bundles and Proxy files from source code. Here is a brief introduction to the practical use of Fair.</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*l2sAnSyyGGfOYjjT.png" alt="img"></p> <p>The idea of DSL generation is shown in the figure above, which is to generate CustomAST from the source code through fair_ast_get, and then CustomAST through fair_dsl_gen to generate the target Fair DSL. Let’s look at the overall workflow of the converter.</p> <p><img src="https://cdn-images-1.medium.com/max/1600/0*JwNMTvJvTbcMQ4qc.png" alt="img"></p> <p>First of all, we abstract the syntax nodes of 100+ into identifiers, literals, expressions and syntax blocks, and the other five classes, including 30+ kinds of commonly used nodes. At the same time, we strip away the information irrelevant to business parsing, and only retain the key information in the original Node. Makes node resolution clearer.</p> <p>The original syntax tree has a large amount of data, and the Visitor schema is not convenient for us to deal with the business in context, so we need to simplify and construct our own syntax tree to facilitate our subsequent processing</p> <h2 id="next"><a href="#next" class="header-anchor">#</a> Next</h2> <p>The Flutter Fair package is a little exploration on Flutter dynamic update. It will be open source soon: https://github.com/wuba.</p> <p>You can also find document about Flutter Fair at https://fair.hacktons.cn/</p> <blockquote><p>It’s mandarin, sorry for not providing English version, any i18n translation is appreciated!!😁</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/layout_sugar.html" class="prev">
        模板语法【实验】
      </a></span> <span class="next"><a href="/article/widget_update.html">
        组件绑定与局部刷新
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7150d990.js" defer></script><script src="/assets/js/2.a909edba.js" defer></script><script src="/assets/js/23.6c99de55.js" defer></script>
  </body>
</html>
